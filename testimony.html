<!doctype html>
<html lang="en">

	<head>
		<meta charset="utf-8">

		<title>Test your applications</title>

		<meta name="description" content="A short guide how to test your Laravel 4 application">
		<meta name="author" content="Milan Popovic">

		<meta name="apple-mobile-web-app-capable" content="yes" />
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">

		<link rel="stylesheet" href="css/reveal.css">
		<link rel="stylesheet" href="css/theme/black.css" id="theme">
		<link rel="stylesheet" href="css/presentation/testimony.css">

		<!-- Code syntax highlighting -->
		<link rel="stylesheet" href="lib/css/zenburn.css">

		<!-- Printing and PDF exports -->
		<script>
			var link = document.createElement( 'link' );
			link.rel = 'stylesheet';
			link.type = 'text/css';
			link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
			document.getElementsByTagName( 'head' )[0].appendChild( link );
		</script>

		<!--[if lt IE 9]>
		<script src="lib/js/html5shiv.js"></script>
		<![endif]-->
	</head>

	<body>

		<div class="reveal">

			<!-- Any section element inside of this container is displayed as a slide -->
			<div class="slides">
				<section>
					<h1>Testimony about testing</h1>
					<p>
						<small>Presented by <a href="http://milanpopovic.me">Milan Popović</a> / <a href="http://twitter.com/komita1981">@komita1981</a></small>
					</p>
				</section>

                <section>
                    <h2>Me</h2>
                    <p>
                        PHP developer
                    </p>
                    <p>
                        7 years in PHP development
                    </p>
                    <p>
                        Work for 12 Mnkys
                    </p>
                    <p>
                        I like to learn and share knowledge
                    </p>
                    <p>
                        Active member of PHP Srbija
                    </p>
                </section>

                <section>
                    <h2>You?</h2>
                    <p class="fragment">
                        Who are you?
                    </p>
                    <p class="fragment">
                        What's your experience in programming?
                    </p>
                    <p class="fragment">
                        What's your experience in testing?
                    </p>
                    <p class="fragment">
                        What are your expectations?
                    </p>
                </section>

                <section>
                    <h2>
                        What is testing?
                    </h2>
                    <p class="fragment">
                        Testing is the activity of finding out whether a piece of code produces the intended behavior
                    </p>
                    <aside class="notes">
                        It better for you that you find your bugs than your client.

                        Quality is everyone’s responsibility—especially - ours - developer’s.

                        You are not good developer if you are not good tester.
                    </aside>
                </section>

                <section>
                    <section>
                        <h2>What do people think about testing?</h2>
                    </section>

                    <section>
                        <img class="noframes" src="img/testimony/i-dont-always-test-my-code.jpg">
                    </section>

                    <section>
                        <p>
                            <img class="noframes" src="img/testimony/code_without_tests.jpeg">
                        </p>
                        <aside class="notes">
                            Time consuming - Who has time to write tests???
                        </aside>
                    </section>

                    <section>
                        <p>
                            <img class="noframes" src="img/testimony/hard-work.jpg" height="600px" width="790px">
                        </p>
                        <aside class="notes">
                            Testing is hard
                        </aside>
                    </section>

                    <section>
                        <p>
                            <img class="noframes" src="img/testimony/steep_learning_curve.jpg">
                        </p>
                        <aside class="notes">
                            Steep learning curve
                        </aside>
                    </section>

                    <section>
                        <p>
                            <img class="noframes" src="img/testimony/no-money.jpg">
                        </p>
                        <aside class="notes">
                            Don’t make anybody any money
                        </aside>
                    </section>

                    <section>
                        <p>
                            Time consuming
                        </p>
                        <p>
                            Testing is hard
                        </p>
                        <p>
                            Steep learning curve
                        </p>
                        <p>
                            Don’t make anybody any money
                        </p>
                    </section>
                </section>

                <section>
                    <p>
                        <img class="noframes" src="img/testimony/true_or_false.png">
                    </p>
                </section>

                <section>
                    <blockquote>
                        "The problem is that people think that code quality is a short term loss but a long term benefit.
                        They’re wrong about the first part."
                    </blockquote>
                    <p>
                        Uncle Bob Martin
                    </p>
                </section>

                <section>
                    <p>
                        <img class="noframes" src="img/testimony/results_or_excuses.jpg">
                    </p>
                </section>

                <section>
                    <h2>What testing really is?</h2>

                    <p class="fragment">
                        Prove you've done your work
                    </p>

                    <p class="fragment">
                        Help you check much faster if you're work is done
                    </p>

                    <p class="fragment">
                        Enable change - protect you from breaking things - regression bugs
                    </p>

                    <p class="fragment">
                        Help you make better code design - easier to maintain
                    </p>

                    <p class="fragment">
                        Let you apply changes with less worries - refactoring will improve things without breaking anything
                    </p>

                    <p class="fragment">
                        Ensures stable, long lasting application
                    </p>

                    <p class="fragment">
                        Enhance security
                    </p>

                    <p class="fragment">
                        Free documentation
                    </p>

                    <aside class="notes">
                        4. Keep your code flexible, maintainable and reusable

                        Keep in mind that testing code is important as production code - maybe more important. It must
                        be clean as production code. Code changes and that means that your tests also changes - if you
                        write them bad than you have big problem - double problem. You are not safe anymore. You will start
                        writing code without tests.

                        Unit tests keep our code flexible, maintainable and reusable. Without them we loose everything.
                        With good tests we can improve architecture and design without having the fear of introducing
                        bugs.


                    </aside>
                </section>
                <section>
                    <h2>Automated testing</h2>
                    <p class="red_text">
                        When I say testing I mean AUTOMATED testing
                    </p>
                    <p>
                        Manual testing is time consuming and boring
                    </p>
                    <p>
                        Automated testing is fun and a key point for software quality
                    </p>
                </section>

                <section>
                    <h2>Test types</h2>
                    <p class="fragment">
                        Acceptance (end-to-end)<br/>
                        Test as if end user would use the whole system/feature
                    </p>
                    <p class="fragment">
                        Integration<br/>
                        Test how different parts of system work together
                    </p>
                    <p class="fragment">
                        Unit<br/>
                        Test single unit of code - mock all dependencies
                    </p>
                </section>

                <section>
                    <h2>What we need to define</h2>
                    <p>
                        What is unit testing?
                    </p>
                    <p>
                        What is to be tested?
                    </p>
                    <p>
                        What does not need to be tested?
                    </p>
                    <p>
                        Unit testing
                    </p>
                </section>

                <section>
                    <h2>
                        What is unit testing?
                    </h2>
                    <p class="fragment">
                        A software testing method to test individual unit of source code - a method in class or a piece of code
                    </p>
                    <p class="fragment">
                        A real unit test verifies the behavior of a single code unit isolated from its dependencies
                    </p>
                </section>

                <section>
                    <p>
                        What is to be tested?
                    </p>
                    <h2 class="fragment">
                        <span class="red_text">
                            EVERYTHING
                        </span>
                    </h2>
                </section>

                <section>
                    <h2>
                        What does not need to be tested?
                    </h2>
                    <p class="fragment">
                        Getters/Setters
                    </p>
                    <p class="fragment">
                        Framework
                    </p>
                    <p class="fragment">
                        Third party packages
                    </p>
                    <p class="fragment">
                        Protected & private methods and properties
                    </p>
                </section>


                <section>
                    <h2>
                        Unit testing first principles
                    </h2>
                    <p class="left_align">
                        <span class="red_text">F</span>ast - Be fast or be dead
                    </p>
                    <p class="left_align">
                        <span class="red_text">I</span>ndependent - Run without dependency
                    </p>
                    <p class="left_align">
                        <span class="red_text">R</span>epeatable - Should be idempotent
                    </p>
                    <p class="left_align">
                        <span class="red_text">S</span>elf-verifyng - Just pass or fail
                    </p>
                    <p class="left_align">
                        <span class="red_text">T</span>imely - Write test before production
                    </p>
                    <aside class="notes">
                        Fast - if tests are slow you wont run them frequently, you will start to avoid using it and you
                        will rot your code

                        Independent - test should not depend on each other, no metter in which order you run them - they
                        should always pass

                        Repeatable - No metter in environment you run your tests - they should pass - no excuses. If
                        they are not - you have problem. They should pass on all machines. If they are not repeatable
                        you will always have an excuse

                        Self validating - Test should have boolean output - pass or fail. You should do everything
                        automaticaly

                        Timely - There is one good time when you have to write your tests - just before production code
                        Code change requires new test


                    </aside>
                </section>

                <section>
                    <h2>
                        Write unit tests before or after code?
                    </h2>
                    <p class="fragment">
                        After - You test what you code - Test Last - <span class="red_text">DDT</span>
                    </p>
                    <p class="fragment">
                        Before - You code what you test - Test First - <span class="red_text">TDD</span>
                    </p>
                </section>

                <section>
                    <img class="noframes" src="img/testimony/tdd_circle_of_life.png">

                    <aside class="notes">
                        Only write code if you absolutely have to and always know what your code is supposed to do before
                        you start writing it - and that is what TDD approach provides for you
                    </aside>
                </section>

                <section>
                    <img class="noframes" src="img/testimony/ddt_circle_of_life.png">
                </section>

                <section>
                    <p>
                        <img class="noframes" src="img/testimony/test_statistics.png">
                    </p>
                    <p>
                        IBM & Microsoft - TDD -  20-40% longer to complete but 40-90% fewer bugs in production
                    </p>
                </section>

                <section>
                    <p>
                        By 2022 it will be not be possible to get a professional programming job if you do not practice TDD routinely
                    </p>
                </section>

                <section>
                    <section>
                        <h2>
                            Testing environment
                        </h2>

                        <p>
                            Use Virtual Environments
                        </p>

                        <p>
                            Create you development environment to be same as production
                        </p>
                    </section>

                    <section>
                        <p>
                            <img class="noframes" src="img/testimony/vagrant_docker.png">
                        </p>
                    </section>
                </section>

                <section>
                    <h2>Testing doubles</h2>
                    <ul>
                        <li class="fragment">Dummy</li>
                        <li class="fragment">Fake</li>
                        <li class="fragment">Stub</li>
                        <li class="fragment">Mock</li>
                        <li class="fragment">Spy</li>
                    </ul>
                </section>

                <section>
                    <h2>Generation doubles doubles</h2>
                    <ul>
                        <li>phpunit/phpunit-mock-object</li>
                        <li>phpspec/prophecy</li>
                        <li>mockery/mockery</li>
                        <li>phake/phake</li>
                        <li>codeception/aspect-mock</li>
                        <li>php-vci/php-vci</li>
                    </ul>
                </section>

                <section>
                    <p>
                        <img class="noframes" src="img/testimony/phpunit.png">
                    </p>
                    <p>
                        <img class="noframes" src="img/testimony/mockery.jpg">
                    </p>
                </section>

                <section>
                    <section>
                        <h2>
                            PHPUnit
                        </h2>

                        <p>
                            Member of xUnit family
                        </p>

                        <p>
                            Created by Sebastian Bergmann and contributors
                        </p>

                        <p>
                            Integrated/Supported by all modern frameworks
                        </p>

                        <p>
                            Integrated in most IDE (PHPStorm, Netbeans, Eclipse, Zend Studio)
                        </p>

                        <p>

                    </section>
                    <section>
                        <p>
                            Written for PHP 5.x
                        </p>
                        <p>
                        Install using composer or phar

                    <pre><code data-trim contenteditable>
"require-dev": {
    "phpunit/phpunit": "4.2.*"
},
                    </code></pre>
                        </p>
                        <p>
                            PEAR install - not supported from 1.1.2015
                        </p>
                        <p>
                            Result can be ., F, E, I, S
                        </p>
                    </section>

                    <section>
                        <h2 class="cc_logo_fix_50">
                            PHPUnit's test goals
                        </h2>

                        <p class="fragment">
                            Easy to learn to write
                        </p>

                        <p class="fragment">
                            Easy to write
                        </p>

                        <p class="fragment">
                            Easy to read
                        </p>

                        <p class="fragment">
                            Easy to execute
                        </p>

                        <p class="fragment">
                            Quick to execute
                        </p>

                        <p class="fragment">
                            Isolated
                        </p>

                        <p class="fragment">
                            Composable
                        </p>

                    </section>

                    <section>
                        <h2>
                            Test config & structure
                        </h2>

                        <p>
                            Configured in <span class="red_text">phpunit.xml</span>  file
                        </p>

                        <p>
                            The tests for a class <span class="red_text">Class</span> go into a class <span class="red_text">ClassTest</span>
                        </p>

                        <p>
                            ClassTest inherits (most of the time) from <span class="red_text">PHPUnit_Framework_TestCase</span>
                        </p>

                        <p>
                            The tests are public methods that are named <span class="red_text">test*</span>
                        </p>

                        <p>
                            Inside the test methods assertion methods are used - <span class="red_text">assert*</span>
                        </p>

                    </section>

                    <section>
                        <pre><code data-trim contenteditable>
<phpunit backupGlobals="false"
         backupStaticAttributes="false"
         bootstrap="bootstrap/autoload.php"
         colors="true"
         convertErrorsToExceptions="true"
         convertNoticesToExceptions="true"
         convertWarningsToExceptions="true"
         processIsolation="false"
         stopOnFailure="false"
         syntaxCheck="false"
        >
    <testsuites>
        <testsuite name="Libraries">
            <directory>./app/tests/Unit/Libraries/</directory>
        </testsuite>
        <testsuite name="Unit">
            <directory>./app/tests/Unit/</directory>
        </testsuite>
        <testsuite name="Integration">
            <directory>./app/tests/Integration/</directory>
        </testsuite>
        <testsuite name="RunAll">
            <directory>./app/tests/</directory>
        </testsuite>
    </testsuites>
</phpunit>
                    </code></pre>

                    </section>

                    <section>
                        <h2 class="cc_logo_fix_50">
                            Assertion methods examples
                        </h2>

                        <p>
                            <span class="red_text">AssertTrue</span> - Check the input to verify it equals true
                        </p>

                        <p>
                            <span class="red_text">AssertFalse</span> - Check the input to verify it equals false
                        </p>

                        <p>
                            <span class="red_text">AssertEquals</span> - Check the result against another input for a match
                        </p>

                        <p>
                            <span class="red_text">AssertContains</span> - Check that the input contains a certain value
                        </p>

                        <p>
                            Many more asserts - official documentation...
                        </p>

                    </section>
                </section>

                <section>
                    <section>
                        <pre><code data-trim contenteditable>

class Calculator
{
    public function add($a, $b)
    {
        return $a + $b;
    }
}
                        </code></pre>

                    </section>

                    <section>
                    <pre><code data-trim contenteditable>
class CalculatorTest extends PHPUnit_Framework_TestCase
{
    protected $calculator;

    public function setUp()
    {
        $this->calculator = new Calculator();
        parent::setUp();
    }

    public function testSuccessfulAdd()
    {
        $this->assertEquals(9, $this->calculator->add(3, 6));
    }

    public function tearDown()
    {
    parent::tearDown();
    }
}
                        </code></pre>

                    </section>

                    <section>
                        <p>
                            <img class="noframes" src="img/testimony/test_1.png">
                        </p>
                    </section>

                    <section>
                        <pre><code data-trim contenteditable>
/**
* @dataProvider getSuccessfulAddData
*/
public function testSuccessfulAdd($data)
{
    $this->assertEquals($data['result'],
                        $this->calculator->add($data['a'], $data['b']));
}

public function getSuccessfulAddData()
{
    return array(
        array(
            array('a' => 1, 'b' => 2, 'result' => 3),
            array('a' => 2, 'b' => 1, 'result' => 3),
            array('a' => 0, 'b' => 1, 'result' => 1),
            array('a' => 1, 'b' => 0, 'result' => 1),
        )
    );
}
                        </code></pre>

                    </section>
                    <section>
                        <pre><code data-trim contenteditable>
/**
* @dataProvider getUnsuccessfulAddData
*/
public function testUnsuccessfulAdd($data)
{
    $this->setExpectedException($data['expectedException']);
    $this->calculator->add($data['a'], $data['b']);
}

public function getUnsuccessfulAddData()
{
    return array(
        array(
            array('a' => 'string', 'b' => 2, 'result' => 2, 'expectedException' => 'Exception'),
            array('a' => 2, 'b' => 'string', 'expectedException' => 'Exception'),
            array('a' => 'string', 'b' => 'string', 'expectedException' => 'Exception'),
        )
    );
}
                        </code></pre>

                    </section>

                    <section>
                        <p>
                            <img class="noframes" src="img/testimony/test_2.png">
                        </p>
                    </section>

                    <section>
                        <pre><code data-trim contenteditable>
class Calculator
{
    public function add($a, $b)
    {
        if (! is_int($a) or ! is_int($b)){
            throw new Exception('Only integers allowed');
        }

        return $a + $b;
    }
}
                        </code></pre>

                    </section>

                    <section>
                        <p>
                            <img class="noframes" src="img/testimony/test_3.png">
                        </p>
                    </section>


                    <section>
                        <pre><code data-trim contenteditable>
class ScientificCalculator
{
    public function complex($a)
    {
        return "Too complex $a";
    }
}

class Calculator
{
    public function complex($a)
    {
        $scientificCalculator = new ScientificCalculator();

        return $scientificCalculator->complex($a);
    }
}
                        </code></pre>

                    </section>

                    <section>
                        <p>
                            <img class="noframes" src="img/testimony/wrong.jpg">
                        </p>
                    </section>

                    <section>
                        <pre><code data-trim contenteditable>
class ScientificCalculator
{
    public function complex($a)
    {
        return "Too complex $a";
    }
}

class Calculator
{
    protected $scientificCalculator;

    public function __construct(ScientificCalculator $scientificCalculator)
    {
        $this->scientificCalculator = $scientificCalculator;
    }

    public function complex($a)
    {
        return $this->scientificCalculator->complex($a);
    }
}
                        </code></pre>

                    </section>

                    <section>
                        <pre><code data-trim contenteditable>
class CalculatorTest extends PHPUnit_Framework_TestCase
{
    protected $calculator;

    public function setUp()
    {
        $this->calculator = new Calculator(new ScientificCalculator());
        parent::setUp();
    }
    ...
                        </code></pre>

                    </section>

                    <section>
                        <p>
                            <img class="noframes" src="img/testimony/wrong.jpg">
                        </p>
                    </section>

                    <section>
                        <pre><code data-trim contenteditable>
class CalculatorTest extends PHPUnit_Framework_TestCase
{
    protected $calculator;
    protected $scientificCalculatorMock;

    public function setUp()
    {
        $this->scientificCalculatorMock = $this->getMockBuilder('ScientificCalculator')->getMock();
        $this->calculator = new Calculator($this->scientificCalculatorMock);
        parent::setUp();
    }


public function testSuccessfulComplex()
{
    $a = 1;
    $returnValue = "Something";

    $this->scientificCalculatorMock
        ->expects($this->once())
        ->method('complex')
        ->with($this->equalTo($a))
        ->will($this->returnValue($returnValue));

    $this->assertEquals($returnValue, $this->calculator->complex($a));
}
                        </code></pre>

                    </section>

                    <section>
                        <p>
                            <img class="noframes" src="img/testimony/test_4.png">
                        </p>
                    </section>
                </section>

                <section>
                    <p>
                        <img class="noframes" src="img/testimony/code-coverage.png">
                    </p>

                    <aside class="notes">
                        The higher code coverage makes your confidence also high - less fear of change
                    </aside>
                </section>

                <section>
                    <p class="red_text">
                        Test branch coverage not code coverage
                        <pre><code data-trim contenteditable>
sampleMethod(){
    if (a < 5 and b > 10){
        return a + b;
    }

    return $a - $b;
}
                    </code></pre>
                    </p>

                </section>

                <section>
                    <section>
                        <h2>Mockery</h2>
                        <p>
                            Created by Pádraic Brady and contributors
                        </p>
                        <p>
                            Simple, powerful framework for creating Mock Objects
                        </p>
                        <p>
                            Install through Composer
                        </p>
                        <pre><code data-trim contenteditable>
"require-dev": {
    "mockery/mockery": "0.9.*@dev"
},
                        </code></pre>
                    </section>

                    <section>
                        <h2>
                            Mock method
                        </h2>
                        <p>
                        <pre><code data-trim contenteditable>
$mockedObject = Mockery::mock('\Show\ExampleClass');
                        </code></pre>
                        </p>
                        <p>Partial mocks</p>
                        <p>
                            <pre><code data-trim contenteditable>
                            $mockedObject = Mockery::mock('\Show\ExampleClass[save, send]');
                            </code></pre>
                        </p>
                        <p>
                            <pre><code data-trim contenteditable>
                            $mockedObject = Mockery::mock('\Show\ExampleClass')->makePartial();
                            </code></pre>
                        </p>
                    </section>

                    <section>
                        <h2>Should Receive</h2>
                            <p>
                            <pre><code data-trim contenteditable>
$this->mock->shouldReceive('methodName');
                            </code></pre>
                            </p>
                    </section>
                    <section>
                        <h2>Once, Twice, Times(n), Never</h2>
                        <p>
                            <pre><code data-trim contenteditable>
$this->mock
     ->shouldReceive('methodName')
     ->once();
                            </code></pre>
                        </p>
                        <p>
                            <pre><code data-trim contenteditable>
$this->mock
     ->shouldReceive('methodName')
     ->never();
                            </code></pre>
                        </p>
                    </section>
                    <section>
                        <h2>With</h2>
                        <p>
                            <pre><code data-trim contenteditable>
$this->mock
     ->shouldReceive('methodName')
     ->once()
     ->with($params);
                            </code></pre>
                        </p>
                    </section>
                    <section>
                        <h2>And Return</h2>
                        <p>
                            <pre><code data-trim contenteditable>
$mockedObject = Mockery::mock('\Show\ExampleClass');
$mockedObject
    ->shouldReceive('all')
    ->once()
    ->with($param)
    ->andReturn('foo');
                            </code></pre>
                        </p>
                    </section>
                </section>
				<section>
                    <h2>
                        Testing in Laravel 4
                    </h2>

                    <p>
                        Built with unit testing in mind
                    </p>

                    <p>
                        Utilizes the Symfony HttpKernel, DomCrawler, and BrowserKit components
                    </p>

                    <p>
                        All tests inherit app/tests/TestCase.php file
                    </p>
				</section>
                <section>
                    <pre><code data-trim contenteditable>
class TestCase extends Illuminate\Foundation\Testing\TestCase {
    /**
    * Creates the application.
    *
    * @return \Symfony\Component\HttpKernel\HttpKernelInterface
    */
    public function createApplication()
    {
        $unitTesting = true;
        $testEnvironment = 'testing';
        return require __DIR__.'/../../bootstrap/start.php';
    }
}
                    </code></pre>
                </section>
                <section>
                    <pre><code data-trim contenteditable>
abstract class TestCase extends \PHPUnit_Framework_TestCase {

use ApplicationTrait, AssertionsTrait;
                        ...
                    </code></pre>
                </section>
				<section>
                    <p>
                        <span class="red_text">ApplicationTrait</span>
                    </p>
                    <p class="left_align">
                        <span class="red_text">cal(...)</span> - Call the given URI and return the Response
                    </p>

                    <p class="left_align">
                        <span class="red_text">action(...)</span> - Call a controller action and return the Response
                    </p>

                    <p class="left_align">
                        <span class="red_text">route(...)</span> - Call a named route and return the Response
                    </p>

                    <p class="left_align">
                        <span class="red_text">seed($class = 'DatabaseSeeder')</span> - Seed a given database connection
                    </p>

                    <p class="left_align">
                        <span class="red_text">be(...)</span> - Set the currently logged in user for the application
                    </p>
				</section>
				<section>
                    <p class="cc_logo_fix_50">
                        <span class="red_text">AssertionsTrait</span>
                    </p>
                    <p class="left_align">
                        <span class="red_text">assertResponseOk()</span> - Assert that the client response has an OK status code
                    </p>

                    <p class="left_align">
                        <span class="red_text">assertResponseStatus($code)</span> - Assert that the client response has a given code
                    </p>

                    <p class="left_align">
                        <span class="red_text">assertViewHas($key, $value = null)</span> - Assert that the response view has a given piece of bound data
                    </p>

                    <p class="left_align">
                        <span class="red_text">assertRedirectedTo($uri, $with = array())</span> - Assert whether the client was redirected to a given URI
                    </p>
				</section>
                <section>
                    <h2>Mocking facades</h2>
                    <pre><code data-trim contenteditable>
public function crypt()
{
    Crypt::setKey('someKey');
}

                    </code></pre>
                    <pre><code data-trim contenteditable>
public function testCrypt()
{
    Crypt::shouldReceive('setKey')->once()->with($key);
}
                    </code></pre>
                    <p>
                        shouldReceive method called on the facade return an instance of a Mockery mock
                    </p>
                </section>
				<section>
                    <pre><code data-trim contenteditable>
public function __construct(User $userModel)
{
    $this->userModel = $userModel;
}
public function store()
{
    $userData = Input::all();

    if(! $this->userModel->validate($userData)){
        throw new StoreResourceFailedException($this->userModel->getErrors());
    }

    try{
        $userModel = $this->userModel->create($userData);

        if (! $userModel instanceof User){
            throw new StoreResourceFailedException();
        }

        return $userModel;
    }catch (Exception $e){
        throw new StoreResourceFailedException('Failed');
    }
}
                        </code></pre>
				</section>

				<section>
				    <section>
                        <pre><code data-trim contenteditable>
use Mockery as m;

class UserControllerTest extends TestCase
{
    public function setUp()
    {
        parent::setUp();
        $this->userModel = m::mock('Eloquent', 'Api\Models\User');
    }


    public function tearDown()
    {
        parent::tearDown();
        m::close();
    }
                            ...
                        </code></pre>
				    </section>
				    <section>
                        <pre><code data-trim contenteditable>
public function testSuccessfulStore()
{
    $data = ['first_name' => 'John', 'last_name' => 'Doe', 'email' => 'john@johndoe.com'];

    $this->userModel
        ->shouldReceive('validate')
        ->once()
        ->with($data)
        ->andReturn(true);

    $mockedUserModel = m::mock('Eloquent', 'Api\Models\User');

    $this->userModel
        ->shouldReceive('create')
        ->once()
        ->andReturn($mockedUserModel);

    $this->app->instance('Models\User', $this->userModel);

    $response = $this->call('POST', $this->createUri('users'));

    $this->assertResponseOk();
    $this->assertContains(json_encode($data), $response->getContent());
}
                        </code></pre>
				    </section>
				    <section>
                        <pre><code data-trim contenteditable>
public function testUnsuccessfulStore()
{
    $data = ['first_name' => 'John', 'last_name' => 'Doe'];
    $errorMessage = 'Error';

    $this->userModel
        ->shouldReceive('validate')
        ->once()
        ->with($data)
        ->andReturn(false);

    $this->userModel
        ->shouldReceive('getErrors')
        ->once()
        ->andReturn($errorMessage);

    $this->userModel
        ->shouldReceive('create')
        ->never();

    $this->app->instance('Models\User', $this->userModel);

    $response = $this->call('POST', $this->createUri('users'));

    $this->assertResponseStatus(422);
    $this->assertContains($errorMesage, $response->getContent());
}
                        </code></pre>
				    </section>
				</section>

                <section>
                    <section>
                        <h2>Programming sins</h2>
                        <p class="fragment">
                            <span class="red_text">New Operators - new ClassName()</span>
                        </p>
                        <p class="fragment">
                            <span class="red_text">Using statics</span> - SomeClass::someMethod()
                        </p>
                        <p class="fragment">
                            <span class="red_text">Endless "anding"</span> - Break SRP
                        </p>
                    </section>

                    <section>
                        <h2>Programming sins</h2>

                        <p class="fragment">
                            <span class="red_text">Logic in constructor</span> - only assign variables
                        </p>

                        <p class="fragment">
                            <span class="red_text">Using switch-case often</span> - use design patterns instead
                        </p>

                        <p class="fragment">
                            <span class="red_text">Too many dependencies</span> - max 4 dependencies
                        </p>
                    </section>
                </section>
                <section>
                    <section>
                        <h2>Advices</h2>
                        <p class="fragment">
                           Try with writing tests after writing the code
                        <p>
                        <p class="fragment">
                            Do not make tests complex
                        <p>
                        <p class="fragment">
                            Do not duplicate test code
                        <p>
                        <p class="fragment">
                            Be descriptive about what you are testing
                        <p>
                        <p class="fragment">
                            Treat test like your code - keep it "clean"
                        <p>

                        <aside class="notes">
                            Tests are clean if they are readable. What make them readable is clarity, simplicity and
                            density of expression - Clean Code - Robert C Martin
                            "What makes a clean test? Three things - Readability, readability, readability
                            Readability is even more important than in production code
                            One assert per test

                        </aside>

                    </section>

                    <section>
                        <h2>Advices</h2>

                        <p class="fragment">
                            Run tests often - after every change and before any commit
                        <p>

                        <p class="fragment">
                            Test before refactoring
                        </p>

                        <p class="fragment">
                            Use test saboteurs (Humbug project)
                        <p>

                        <p class="fragment">
                            When you get confidence try to write tests before the code
                        <p>
                    </section>

                    <section>
                        <h2>Advices</h2>

                        <p class="fragment">
                            Use "learning tests" when you work with external API
                        <p>

                        <p class="fragment">
                            Use continuous integration server
                        <p>

                    </section>
                    <aside class="notes">
                        Test early, test often, test automatically

                        When you test two related classes keep in mind that expectations meets actions and answers
                        match assertions

                        Jim Newkirk introduced term learning tests. It's better to write tests for some external API
                        while you are learning. Once API version change you can just run your tests.
                    </aside>
                </section>

                <section>
                    <p>
                        <img height="680" class="noframes" src="img/testimony/laravel_testing_decoded.jpg">
                    </p>
                </section>
				<section>
                    <section>
                        <h2>Resources</h2>
                        <ul>
                            <li><a href="http://www.redbubble.com/people/fitbys/works/10613559-results-or-excuses-fitness-slogan-retro?p=art-print">http://www.redbubble.com/people/fitbys/works/10613559-results-or-excuses-fitness-slogan-retro?p=art-print</a></li>
                            <li><a href="http://www.slideshare.net/damiansromek/php-tests-tips">http://www.slideshare.net/damiansromek/php-tests-tips</a></li>
                            <li><a href="http://www.slideshare.net/ChonlasithJucksripor/unit-test-39809217">http://www.slideshare.net/ChonlasithJucksripor/unit-test-39809217</a></li>
                            <li><a href="http://blog.typemock.com/2009/03/the-cost-of-test-driven-development.html">http://blog.typemock.com/2009/03/the-cost-of-test-driven-development.html</a></li>
                            <li><a href="http://lh5.ggpht.com/-jDpF-eS-6TE/UQo_mozEkkI/AAAAAAAAHUg/uu9F08Atq9I/wrong_thumb%25255B39%25255D.jpg?imgmax=800">http://lh5.ggpht.com/-jDpF-eS-6TE/UQo_mozEkkI/AAAAAAAAHUg/uu9F08Atq9I/wrong_thumb%25255B39%25255D.jpg?imgmax=800</a></li>
                            <li><a href="https://vimeo.com/63492364"></a>Sebastian Bergmann in Atlanta</li>
                        </ul>
                    </section>
                    <section>
                        <h2>Images</h2>
                        <ul>
                            <li><a href="http://images.sodahead.com/polls/001599249/4445136897_Question_Mark_000007651615XSmall_answer_101_xlarge.jpeg">http://images.sodahead.com/polls/001599249/4445136897_Question_Mark_000007651615XSmall_answer_101_xlarge.jpeg</a></li>
                            <li><a href="https://image-store.slidesharecdn.com/ebe9e374-6d3e-4f1a-8051-9591ef7ea7a3-original.jpeg">https://image-store.slidesharecdn.com/ebe9e374-6d3e-4f1a-8051-9591ef7ea7a3-original.jpeg</a></li>
                            <li><a href="https://lh4.ggpht.com/W3DVtNTVIAvZfJ99kDT2hP5cxklxZfLMGehfox8WFCzVk49LOUW-exgVXifFxDKkPts=w300">https://lh4.ggpht.com/W3DVtNTVIAvZfJ99kDT2hP5cxklxZfLMGehfox8WFCzVk49LOUW-exgVXifFxDKkPts=w300</a></li>
                            <li><a href="http://postd.cc/wp/wp-content/uploads/2014/07/vagrant_docker.png"></a>http://postd.cc/wp/wp-content/uploads/2014/07/vagrant_docker.png</li>
                            <li><a href="http://blog.stuartherbert.com/php/wp-content/uploads/2011/03/ishot-23.png"></a>http://blog.stuartherbert.com/php/wp-content/uploads/2011/03/ishot-23.png</li>
                            <li><a href="http://lh3.ggpht.com/-X8LPVvE5BYE/UHaLknLmMmI/AAAAAAAABg0/HDu3iZAs2yg/s1600-h/image7.png">http://lh3.ggpht.com/-X8LPVvE5BYE/UHaLknLmMmI/AAAAAAAABg0/HDu3iZAs2yg/s1600-h/image7.png</a></li>
                            <li><a href="http://quotespics.com/wp-content/quote-images/i-dont-always-test-my-code.jpg">Testing code in production</a></li>
                            <li><a href="http://financialjuneteenth.com/wp-content/uploads/2015/02/hard-work.jpg">Hard work</a></li>
                            <li><a href="https://www.dashingd3js.com/assets/steep_learning_curve-7c6e27560aabbd16a3ddb4eca06fe2fb.jpg">Steep learning curve</a></li>
                        </ul>
                    </section>
				</section>

				<section>
					<h1>THANK YOU</h1>
				</section>

				<section>
					<h1>QUESTIONS?</h1>
				</section>

			</div>

		</div>

		<script src="lib/js/head.min.js"></script>
		<script src="js/reveal.js"></script>

		<script>

			// Full list of configuration options available at:
			// https://github.com/hakimel/reveal.js#configuration
			Reveal.initialize({
				controls: true,
				progress: true,
				history: true,
				center: true,

				transition: 'slide', // none/fade/slide/convex/concave/zoom

				// Optional reveal.js plugins
				dependencies: [
					{ src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
					{ src: 'plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/highlight/highlight.js', async: true, condition: function() { return !!document.querySelector( 'pre code' ); }, callback: function() { hljs.initHighlightingOnLoad(); } },
					{ src: 'plugin/zoom-js/zoom.js', async: true },
					{ src: 'plugin/notes/notes.js', async: true }
				]
			});

		</script>

	</body>
</html>
<!--
@todo
Dodati jos neki primer za L4 - integration testing
-->